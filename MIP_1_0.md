# Member Interchange Protocol Specification

## Lead Author: Mark Menard (Groupable)

### November 30, 2025

## MIP 1.0 Functions Overview

### Connection Protocol

- MIP Connection Request: Request a connection between two organizations that implement MIP.
- MIP Connection Approvde: Notify an organization that has requested a connection that their request has been approved.
- MIP Connection Declined: Notify an organization that has requested a connection that their request has been declined.
- MIP Connection Revoked: Notify an organization that their connection has been revoked and no more requests will be honored.
- MIP Connection Restored: Notify an organization that their connection has been restored and requests will be honored.
- Organization Update: Push updated organization information to a connected organization and request their updated information. (This could be used if an organization changes URLs to notify their connected organizations of that change.)
- New Organization Notification: Notify connected organizations that a new organization has joined the ecosystem.
- Connected Organizations Query: Request a list of organizations that a connected organization knows about and has permission to share.
- Endorsement: Send a cryptographic endorsement of another organization's identity to establish web-of-trust.

### Member Protocol

- Member Search Request: Search for a member in a connected system using member number; or first name, last name, and birth date.
- Member Search Reply: Receive a reply to a requested member search. The reply to this request should include the member's type (ie: Master Mason, Fellowcraft, etc.) and the origin system's representation of the member's status and an indicator showing if that status is active, in good standing, and deceased. Additionally a search request can be declined.
- Member Status Check: A quick query to get the current status of a known member, this does not return a full member profile.
- Certificate of Good Standing (COGS) Request: Request a certificate of good standing from a system. This could be answered automatically or manually depending on the requirements of the receiving organization. If it is automatic the COGS will be returned immediately. If the COGS cannot be returned immediately the response will include an ID to track the request and to later receive the COGS.
- Certificate of Good Standing Reply: If a COGS cannot be returned immediately when requested the COGS will be returned to the requesting system using this function. 

## MIP 2.0 Potential Functions

There are many potential functions that could be added to MIP such as:

- Member linking between organizations
- Automatic notification of linked member status change
- Automatic notification of linked member contact information change
- Automatic display of linked member status in member profiles

An important differentiator of using MIP over having a centralized clearing house is there would be no need for a third-party to store the connections between members in discrete member databases. All of those connections would ONLY be housed with the organizations the member belongs to. No need to trust a third-party with your data in any way at all.

## Preliminary Technical Specification

The remainder of this document is a draft of the technical specifications of this protocol and should be considered a work in progress.

## MIP Node Requirements

Each node implementing MIP needs to generate a MIP IDENTIFIER which is a 128 bit unique identifier. This should be done by combining a 128 bit randomly generated number concatenated with a salt based using something unique to the organization such as their name and then deriving the MD5 hash of the of the concatenated number and salt.

For example, the unique identifier could be generated using the following MySQL query:

```sql
SELECT MD5(CONCAT(UUID(), 'Grand Lodge of New York')) AS 'uuid'
```

The same example in Ruby:

```ruby
require 'digest'

uuid = Random.uuid
salt = "Grand Lodge of New York"

md5_hash = Digest::MD5.hexdigest("#{uuid}#{salt}")

puts "MD5 Hash: #{md5_hash}"
```


Each node also needs to generate an RSA public/private key pair for use in signing requests and authenticating identity.

The MIP IDENTIFIER establishes the identity of the MIP node, and the RSA key is used to authenticate all request made using the protocol.

# MIP Request Process

MIP HTTP request will all be done over HTTPS and include header values for things like signatures and other data that are impractical to include in the request body.

All requests that are not HTTP GET will use JSON formatted request bodies.

## MIP Header Parameters

The following headers are required on all MIP requests:

- X-MIP-MIP-IDENTIFIER: The originating organizations MIP identifier that should be a 128 bit random key generated by or on behalf of the organization's software.
- X-MIP-TIMESTAMP: The current time of the request in ISO 8601 format.
- X-MIP-SIGNATURE: The RSA signature for the request. (See below for full specification.)
- X-MIP-PUBLIC-KEY: A Base 64 strict encoded string of the originating organizations RSA public key. This header is only used for requests where the receiving organization does not know the RSA public key of the originating system ahead of time.

## MIP Signatures

The mip signatures are RSA signatures signing a three part document consisting of the:

- The timestamp of the request from the X-MIP-TIMESTAMP header.
- The path of the URL the request is being made to.
- The JSON payload string if any. (This would not be present for GET requests.)

The following is example code that illustrates generating a MIP compliant signagure:

```ruby
require 'openssl'
require 'digest'
require 'base64'
require 'json'
require 'time'

# Generate an RSA key. This would be saved permanently for the organization's MIP configuration. This is a throwaway
# for illustration purposes.
rsa_key_pair = OpenSSL::PKey::RSA.new(2048)

timestamp = Time.now.iso8601
path = "/api/mip/organizations/e82d40e9416304e8c72790b45b27a8e6/mip_connections"
json_payload = { :member_number => 'M123456' }.to_json # Create JSON String

signature = Base64.strict_encode64(rsa_key_pair.sign(OpenSSL::Digest::SHA256.new, "#{timestamp}#{path}#{json_payload}"))

puts signature
```

The rationale for having a three component document to sign is as follows:

- Including the timestamp precludes replay attacks.
- Including the path makes the signature specific to the end point being called and means it can not be reused to attack a different end-point.
- Including the JSON payload assures that the payload has not been modified in transit.

## MIP Response Format

All responses to request are in JSON format with a JSON object consisting of two sections:

- meta: data about the request and its processing, this must include at least an element for succeeded with a true or false value to state if the response was successful. This section could additionally include things like remaining daily request limit, or other meta-data about the request.
- data: this section contains that data that is the response to the request.

Example response:

```json
{
  "meta": {
    "succeeded": true
  },
  "data": {
    "first_name": "John",
    "last_name": "Doe"
  }
}
```

# MIP 1.0 Endpoint Details:

## MIP Connection Protocol

### MIP Connection Request

Request a connection between the sending and receiving MIP Organizations.

#### End Point: /mip/node/<receiving_mip_id>/mip_connections

#### Arguments:

- receiving_mip_id: The MIP Identifier of the receiving organization.

#### HTTP Action: POST

#### Payload Format: JSON

#### Request Payload:

```json
{
  "mip_identifier": "e82d40e9416304e8c72790b45b27a8e6",
  "mip_url": "https://example.com/api/mip/e82d40e9416304e8c72790b45b27a8e6",
  "public_key": "-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqh...\n-----END PUBLIC KEY-----",
  "organization_legal_name": "Grand Lodge of Example",
  "contact_person": "John Smith",
  "contact_phone": "+1-555-123-4567",
  "share_my_organization": true,
  "endorsements": [ /* See Common Data Formats: Endorsement */ ]
}
```

- **mip_identifier**: The requesting organization's 128-bit MIP identifier.
- **mip_url**: Full URL to the requesting organization's MIP API endpoint.
- **public_key**: RSA public key in PEM format for signature verification.
- **organization_legal_name**: Official name of the requesting organization.
- **contact_person**: Name of primary contact for MIP-related matters.
- **contact_phone**: Phone number for the contact person.
- **share_my_organization**: Boolean indicating if this organization's info can be shared with other nodes.
- **endorsements**: Array of endorsements from other organizations vouching for this node's identity. See [Endorsement](#endorsement) in Common Data Formats. Used for automatic trust verification via web-of-trust.

#### Response Payload:

```json
{
  "meta": {
    "succeeded": true
  },
  "data": {
    "mip_connection": {
      "status": "PENDING",
      "daily_rate_limit": 100,
      "node_profile": { ... }
    }
  }
}
```

- **meta.succeeded**: Boolean indicating the request was processed successfully.
- **data.mip_connection.status**: Connection status - will be "PENDING" for new requests awaiting manual approval, or "ACTIVE" if auto-approved via endorsement-based web-of-trust.
- **data.mip_connection.daily_rate_limit**: Maximum number of requests allowed per day from this connection.
- **data.mip_connection.node_profile**: The receiving organization's information. See [Node Profile](#node-profile) in Common Data Formats.

#### Auto-Approval via Web-of-Trust

When a connection request includes endorsements from organizations the receiving node already trusts, the connection may be automatically approved without manual intervention. The receiving system verifies each endorsement cryptographically using public keys it already possesses from its active connections. If the number of valid trusted endorsements meets or exceeds the configured threshold (typically 1), the connection is approved immediately with status "ACTIVE".

This web-of-trust model allows the MIP network to grow more efficiently as organizations accumulate endorsements from their connections. A brand new node with no endorsements will still require manual approval for its first connections, but subsequent connections become progressively easier as the node collects endorsements.

A user can initiate an invitation to any person who has a MIP compliant system. 

The inviter would provide the invitee with their MIP end point URL (ex: https://hi.moriapp.com/integrations/mip/groups/883280d6988dc9326e11a1e8e97a9ae2). 

The invitee would enter the URL into their MIP compliant system which would initiate the handshake between the two systems exchanging RSA public keys for request signing.

As part of the handshake process both the inviter and the invitee can designate if they wish to have their MIP endpoint shared with other known MIP endpoints the other organization knows about.

If the receiving system cannot authenticate the requesting system automatically via endorsements, it should queue the request for end-user approval or declination.

If a request is not approved automatically the requesting party should contact the organization they are attempting to connect with and provide the fingerprint of their RSA public key for verification.

A MIP system can initiate an automatic request for handshake with another node in an eco-system. This request does not require a person to initiate it. These requests would usually take place due to finding out about a node using discovery within the protocol.

As part of the handshake process both the inviter and the invitee can designate if they wish to have their MIP endpoint shared with other known MIP endpoints the other organization knows about.

When a connection is approved (either manually or via endorsement-based auto-approval), both parties exchange endorsements to vouch for each other's identity. These endorsements can then be presented when connecting to other nodes, enabling automatic trust verification via the web-of-trust.

### MIP Connection Approved

End point to notify a requester that their MIP Connection has been approved.

#### Endpoint: /mip/node/<receiving_mip_id>/mip_connections/approved

#### Arguments:

- receiving_mip_id: The MIP Identifier of the receiving organization.

#### HTTP Action: POST

#### Payload Format: JSON

#### Request Payload:

```json
{
  "node_profile": { 'foo': 'bar' },
  "share_my_organization": true,
  "daily_rate_limit": 100,
  "endorsement": { endorsement document (see below)},
  "known_organizations": [
    { ... },
    { ... }
  ]
}
```

- **node_profile**: The approving organization's information. See [Node Profile](#node-profile) in Common Data Formats.
- **share_my_organization**: Boolean indicating if this organization's info can be shared with other connected nodes.
- **daily_rate_limit**: Maximum number of requests allowed per day from this connection.
- **known_organizations**: Array of organizations the approving node knows about and has permission to share. Each element follows the [Node Profile](#node-profile) format. Only includes organizations that have set `share_my_organization` to `true`. This allows the newly approved node to immediately discover and begin connecting to other nodes in the network without requiring a separate Connected Organizations Query.

#### Response Payload:

```json
{
  "meta": {
    "succeeded": true
  },
  "data": {
    "mip_connection": {
      "status": "ACTIVE"
    }
  }
}
```

- **meta.succeeded**: Boolean indicating the approval was processed successfully.
- **data.mip_connection.status**: The updated connection status, will be "ACTIVE" after approval.

### MIP Connection Declined

End point to notify a requester that their MIP Connection has been declined.

#### Endpoint: /mip/node/<receiving_mip_id>/mip_connections/declined

#### Arguments:

- receiving_mip_id: The MIP Identifier of the receiving organization.

#### HTTP Action: POST

#### Payload Format: JSON

#### Request Payload:

```json
{
  "mip_identifier": "e82d40e9416304e8c72790b45b27a8e6",
  "reason": "Organization not recognized. Please contact us directly to establish a connection."
}
```

- **mip_identifier**: The declining organization's 128-bit MIP identifier.
- **reason**: Optional. Human-readable explanation for why the connection was declined.

#### Response Payload:

```json
{
  "meta": {
    "succeeded": true
  },
  "data": {
    "mip_connection": {
      "status": "DECLINED"
    }
  }
}
```

- **meta.succeeded**: Boolean indicating the decline notification was processed successfully.
- **data.mip_connection.status**: The updated connection status, will be "DECLINED".

If a request to handshake is declined by an organization their system should send a decline request to the declined node. 

Note declining a request does not preclude the requesting system from requesting a connection again. For user convenience a system could provide a means for auto-declining repeated requests from the same organization.

### MIP Connection Revoked

#### Endpoint: /mip/node/<receiving_mip_id>/mip_connections/revoked

#### Arguments:

- receiving_mip_id: The MIP Identifier of the receiving organization.

#### HTTP Action: POST

#### Payload Format: JSON

#### Request Payload:

```json
{
  "mip_identifier": "e82d40e9416304e8c72790b45b27a8e6",
  "reason": "Connection revoked due to policy violation."
}
```

- **mip_identifier**: The revoking organization's 128-bit MIP identifier.
- **reason**: Optional. Human-readable explanation for why the connection is being revoked.

#### Response Payload:

```json
{
  "meta": {
    "succeeded": true
  },
  "data": {
    "mip_connection": {
      "status": "REVOKED"
    }
  }
}
```

- **meta.succeeded**: Boolean indicating the revocation was processed successfully.
- **data.mip_connection.status**: The updated connection status, will be "REVOKED".

This end point is used to ask another node to cease sending requests. An implementor can either remove the MIP node information from their system or mark the MIP Nodeâ€™s access revoked. 

The receiving system should mark the node revoked and not send requests to it.

### MIP Connection Restored

#### Endpoint: /mip/node/<receiving_mip_id>/mip_connections/restored

#### Arguments:

- receiving_mip_id: The MIP Identifier of the receiving organization.

#### HTTP Action: POST

#### Payload Format: JSON


#### Request Payload:

```json
{
  "mip_identifier": "e82d40e9416304e8c72790b45b27a8e6"
}
```

- **mip_identifier**: The restoring organization's 128-bit MIP identifier.

#### Response Payload:

```json
{
  "meta": {
    "succeeded": true
  },
  "data": {
    "mip_connection": {
      "status": "ACTIVE"
    }
  }
}
```

- **meta.succeeded**: Boolean indicating the restoration was processed successfully.
- **data.mip_connection.status**: The updated connection status, will be "ACTIVE".

This end point is used to restore a previously revoked connection. After receiving this notification, the organization should mark the connection as active and resume honoring requests.

### Organization Update

#### End Point: /mip/node/<receiving_mip_id>/mip_connections/update

#### Arguments:

- receiving_mip_id: The MIP Identifier of the receiving organization.

#### HTTP Action: POST

#### Payload Format: JSON

#### Request Payload:

```json
{
  "node_profile": { ... }
}
```

- **node_profile**: The updating organization's current information. See [Node Profile](#node-profile) in Common Data Formats.

#### Response Payload:

```json
{
  "meta": {
    "succeeded": true
  },
  "data": {
    "node_profile": { ... }
  }
}
```

- **meta.succeeded**: Boolean indicating the update was processed successfully.
- **data.node_profile**: The receiving organization's current information, allowing the requester to update their records as well. See [Node Profile](#node-profile) in Common Data Formats.

The purpose of this end point is to update a connected node with new information about your group, and to query updated information from the connected node. A system implementing MIP would use this to keep information up to date.

### New Organization Notification

#### End Point: /mip/node/<receiving_mip_id>/new_organization_notification

#### Arguments:

- receiving_mip_id: The MIP Identifier of the receiving organization.

#### HTTP Action: POST

#### Payload Format: JSON

#### Request Payload:

```json
{
  "new_organization": { ... }
}
```

- **new_organization**: Information about the newly discovered organization. See [Node Profile](#node-profile) in Common Data Formats.

#### Response Payload:

```json
{
  "meta": {
    "succeeded": true
  },
  "data": {
    "acknowledged": true
  }
}
```

- **meta.succeeded**: Boolean indicating the notification was processed successfully.
- **data.acknowledged**: Boolean indicating the receiving organization has recorded the new organization information.

The purpose of this end point is to share the existence of a new node to the MIP nodes we are connected with.

### Connected Organizations Query

Request a list of organizations the receiving organization is connected to and has permission to share information.

#### End Point: /mip/node/<receiving_mip_id>/connected_organizations_query

#### Arguments:

- receiving_mip_id: The MIP Identifier of the receiving organization.

#### HTTP Action: GET

#### Payload Format: No Payload

#### Response Payload:

```json
{
  "meta": {
    "succeeded": true
  },
  "data": {
    "organizations": [
      { ... },
      { ... }
    ]
  }
}
```

- **meta.succeeded**: Boolean indicating the query was processed successfully.
- **data.organizations**: Array of organizations the receiving organization knows about and has permission to share. Each element follows the [Node Profile](#node-profile) format in Common Data Formats.

The purpose of the nodes query is to discover other nodes a MIP compliant system knows about and has connected with. This query allows for participating organizations in a MIP ecosystem to discover other members of the ecosystem. For example GL of NY and GL of FL handshake and establish a connection. GL of NY knows the end point and information for GL of MA. After GL of FL has completed its handshake with GL of NY the GL of FL system could query the GL of NY system for what nodes it knows about and then attempt to connect to those nodes.

### Send Endorsement

Send a cryptographic endorsement of another organization to a connected node. Endorsements are exchanged automatically when connections become active, and are used to build a web-of-trust that enables automatic approval of future connection requests.

#### End Point: /mip/node/<receiving_mip_id>/endorsements

#### Arguments:

- receiving_mip_id: The MIP Identifier of the receiving organization.

#### HTTP Action: POST

#### Payload Format: JSON

#### Request Payload:

```json
{
  "endorser_mip_identifier": "e82d40e9416304e8c72790b45b27a8e6",
  "endorsed_mip_identifier": "512ef14957203c6323e79937f3935708",
  "endorsed_public_key_fingerprint": "a1:b2:c3:d4:e5:f6:78:90:ab:cd:ef:12:34:56:78:90",
  "endorsement_document": "{\"type\":\"MIP_ENDORSEMENT_V1\",\"endorser_mip_identifier\":\"e82d40e9416304e8c72790b45b27a8e6\",\"endorsed_mip_identifier\":\"512ef14957203c6323e79937f3935708\",\"endorsed_public_key_fingerprint\":\"a1:b2:c3:d4:e5:f6:78:90:ab:cd:ef:12:34:56:78:90\",\"issued_at\":\"2026-02-04T12:00:00Z\",\"expires_at\":\"2027-02-04T12:00:00Z\"}",
  "endorsement_signature": "g2FAOk4wXU6+j85b+1kpz3kgRH+ZmFIk2YkNkCP5GP8l...",
  "issued_at": "2026-02-04T12:00:00Z",
  "expires_at": "2027-02-04T12:00:00Z"
}
```

- **endorser_mip_identifier**: The MIP identifier of the organization issuing the endorsement.
- **endorsed_mip_identifier**: The MIP identifier of the organization being endorsed.
- **endorsed_public_key_fingerprint**: MD5 fingerprint of the endorsed organization's public key (colon-separated hex).
- **endorsement_document**: The canonical JSON document that was signed. See [Endorsement](#endorsement) in Common Data Formats.
- **endorsement_signature**: Base64-encoded RSA signature of the endorsement_document.
- **issued_at**: ISO 8601 timestamp when the endorsement was created.
- **expires_at**: ISO 8601 timestamp when the endorsement expires.

#### Response Payload:

```json
{
  "meta": {
    "succeeded": true
  },
  "data": {
    "endorsement_id": "abc123-def456-789012"
  }
}
```

- **meta.succeeded**: Boolean indicating the endorsement was processed successfully.
- **data.endorsement_id**: Unique identifier for the stored endorsement.

#### Endorsement Processing

When a node receives an endorsement:

1. Verify the endorser is a known entity (active connection or shared node)
2. Verify the signature using the endorser's public key
3. Verify the endorsement has not expired
4. Verify the fingerprint matches the endorsed organization's known public key
5. Store the endorsement for future trust evaluation

If the endorsement enables auto-approval of any pending connections (by meeting the trust threshold), those connections may be automatically approved.

## Member Protocol

### Member Search Request

End Point: /mip/node/<receiving_mip_id>/mip_member_searches

#### Arguments:

- receiving_mip_id: The MIP Identifier of the receiving organization.

#### HTTP Action: POST

#### Payload Format: JSON

#### Request Payload:

```json
{
  "member_number": "M123456",
  "first_name": "John",
  "last_name": "Doe",
  "birthdate": "1970-01-15",
  "shared_identifier": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
  "notes": "Member is requesting affiliation with our lodge. Please verify current standing.",
  "documents": [
    {
      "name": "Membership Application",
      "url": "https://example.com/documents/application-12345.pdf"
    },
    {
      "name": "Letter of Introduction",
      "url": "https://example.com/documents/intro-letter-12345.pdf"
    }
  ]
}
```

- **member_number**: The publicly known member number for the member in the receiving organization.
- **first_name**: The member's first name.
- **last_name**: The member's last name.
- **birthdate**: The member's date of birth in ISO 8601 format (YYYY-MM-DD).
- **shared_identifier**: A unique identifier for this search request, used to correlate the response.
- **notes**: Optional. Miscellaneous notes or context about the search request.
- **documents**: Optional. Array of supporting documents.
  - **name**: Display name for the document.
  - **url**: URL where the document can be retrieved.

#### Response Payload:

```json
{
  "meta": {
    "succeeded": true
  },
  "data": {
    "status": "PENDING",
    "shared_identifier": "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
  }
}
```

- **meta.succeeded**: Boolean indicating the search request was received successfully.
- **data.status**: Will be "PENDING" - the actual search results will be delivered via the Member Search Reply endpoint.
- **data.shared_identifier**: Echo of the request identifier for correlation.

The search results will be delivered asynchronously via the [Member Search Reply](#member-search-reply) endpoint.

### Member Search Reply

End Point: /mip/node/<receiving_mip_id>/mip_member_searches/reply

#### Arguments:

- receiving_mip_id: The MIP Identifier of the receiving organization.

#### HTTP Action: POST

#### Payload Format: JSON

#### Request Payload:

```json
{
  "meta": {
    "succeeded": true
  },
  "data": {
    "shared_identifier": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
    "status": "APPROVED",
    "matches": [
      {
        "member_number": "NY-123456",
        "first_name": "John",
        "last_name": "Doe",
        "birthdate": "1970-01-15",
        "contact": {
          "email": "john.doe@example.com",
          "phone": "+1-555-123-4567",
          "address": {
            "address1": "123 Main Street",
            "address2": "Apt 4B",
            "city": "Albany",
            "state": "NY",
            "postal_code": "12207",
            "country": "US"
          }
        },
        "group_status": {
          "status": "Active",
          "is_active": true,
          "good_standing": true
        },
        "affiliations": [
          {
            "local_name": "Masters Lodge No. 5",
            "local_status": "Active",
            "is_active": true,
            "member_type": "Master Mason"
          },
          {
            "local_name": "Unity Lodge No. 42",
            "local_status": "Affiliate",
            "is_active": true,
            "member_type": "Master Mason"
          }
        ]
      },
      {
        "member_number": "NY-789012",
        "first_name": "John",
        "last_name": "Doe",
        "birthdate": "1965-03-22",
        "contact": {
          "email": "jdoe65@example.com",
          "phone": "+1-555-987-6543",
          "address": {
            "address1": "456 Oak Avenue",
            "address2": null,
            "city": "Buffalo",
            "state": "NY",
            "postal_code": "14201",
            "country": "US"
          }
        },
        "group_status": {
          "status": "Suspended",
          "is_active": false,
          "good_standing": false
        },
        "affiliations": [
          {
            "local_name": "Harmony Lodge No. 18",
            "local_status": "Suspended NPD",
            "is_active": false,
            "member_type": "Master Mason"
          }
        ]
      }
    ]
  }
}
```

**meta section:**
- **succeeded**: Boolean indicating the request was processed successfully.

**data section:**
- **shared_identifier**: The identifier from the original search request, used to correlate the response.
- **status**: "APPROVED"|"DECLINED"
- **matches**: Array of member profiles matching the search criteria.
  - **member_number**: The member's identifier in the responding organization.
  - **first_name**, **last_name**, **birthdate**: Basic identifying information.
  - **contact**: Contact information object.
    - **email**: Primary email address.
    - **phone**: Primary phone number.
    - **address**: Mailing address with standard fields.
  - **group_status**: The member's status at the group (jurisdiction) level.
    - **status**: The status label as stored in the system.
    - **is_active**: Boolean indicating if this is an active membership status.
    - **good_standing**: Boolean indicating if the member is in good standing.
  - **affiliations**: Array of local group memberships.
    - **local_name**: Name of the local lodge/chapter.
    - **local_status**: The member's status in that local.
    - **is_active**: Boolean indicating if this local membership is active.
    - **member_type**: The member's type/degree in the local (e.g., Master Mason, Fellowcraft).

#### Potential Response Payload:

Standard MIP response indicating success or failure of receiving the search results.

### Member Status Check

End Point: /mip/node/<receiving_mip_id>/member_status_checks

#### Arguments:

- receiving_mip_id: The MIP Identifier of the receiving organization.

#### HTTP Action: POST

#### Payload Format: JSON

#### Request Payload:

```json
{
  "member_number": "NY-123456"
}
```

- **member_number**: The publicly known member number for the member in the receiving organization.

#### Response Payload:

```json
{
  "meta": {
    "succeeded": true
  },
  "data": {
    "member_number": "NY-123456",
    "member_type": "Master Mason",
    "party_short_name": "John D",
    "group_status": {
      "status": "Active",
      "is_active": true,
      "good_standing": true
    }
  }
}
```

- **meta.succeeded**: Boolean indicating the status check was processed successfully.
- **data.member_number**: The member's identifier in the responding organization.
- **data.member_type**: The member's type/degree (e.g., Master Mason, Fellowcraft).
- **data.group_status**: The member's status at the group (jurisdiction) level.
  - **status**: The status label as stored in the system.
  - **is_active**: Boolean indicating if this is an active membership status.
  - **good_standing**: Boolean indicating if the member is in good standing.

If the member is not found:

```json
{
  "meta": {
    "succeeded": true
  },
  "data": {
    "found": false,
    "member_number": "NY-123456"
  }
}
```

The primary purpose for this particular endpoint is to support built-in status checkers to be able to check the status of members in an organization's mobile app. Think of it as the Tyler's integration. For example, an organization that uses Vendor A. Vendor A could present an organization from Vendor B, have the person punch in the member number for the organization B, and then they could use this MIP connection point to talk to organization B and check that member status in real time. The contractual expectation for this endpoint is that these are not queued and approved. These are strictly replied to in real time. Many of the organizations already have a status checker that effectively does this on their websites. This basically allows a third party to do the same thing within their own application.

This could also potentially be used as a means for when someone is visiting another organization and the vendors are different and they present a digital dues card, we could potentially use this for integration to be able to query that on the other organization through our backend instead of going directly and having to trust the credentials being put in front of us. Thank you.

### Certificate of Good Standing Request

Request an official digital Certificate of Good Standing from the receiving Organization. The response from this should be comprehansive to allow the requesting organization to process a new member attempting to join their organization.

#### End Point: /mip/node/<receiving_mip_id>/certificates_of_good_standing

#### Arguments:

- receiving_mip_id: The MIP Identifier of the receiving organization.

#### HTTP Action: POST

#### Payload Format: JSON

#### Request Payload:

```json
{
  "requesting_member": {
    "member_number": "FL-789012",
    "first_name": "James",
    "last_name": "Wilson",
    "birthdate": "1975-06-20"
  },
  "requested_member_number": "NY-123456",
  "notes": "Member is petitioning for affiliation with our lodge."
}
```

- **requesting_member**: Information about the member making the request in the source organization.
  - **member_number**: The member's identifier in the requesting organization.
  - **first_name**: The requesting member's first name.
  - **last_name**: The requesting member's last name.
  - **birthdate**: The requesting member's date of birth in ISO 8601 format (YYYY-MM-DD).
- **requested_member_number**: The publicly known member number for the member in the target organization.
- **notes**: Optional. Context about why the COGS is being requested.

#### Response Payload:

```json
{
  "meta": {
    "succeeded": true
  },
  "data": {
    "status": "PENDING",
    "shared_identifier": "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
  }
}
```

- **meta.succeeded**: Boolean indicating the request was received successfully.
- **data.status**: Will be "PENDING" - the actual certificate or decline will be delivered via the Certificate of Good Standing Notification endpoint.
- **data.shared_identifier**: Tracking ID for correlating the subsequent notification with this request.

### Certificate of Good Standing Reply

#### End Point: /mip/node/<receiving_mip_id>/certificates_of_good_standing/reply

#### Arguments:

- receiving_mip_id: The MIP Identifier of the receiving organization.

#### HTTP Action: POST

#### Payload Format: JSON

#### Request Payload (Approved - Member in Good Standing):

```json
{
  "shared_identifier": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
  "status": "APPROVED",
  "good_standing": true,
  "issued_at": "2025-01-15T14:30:00Z",
  "valid_until": "2025-04-15T14:30:00Z",
  "issuing_organization": {
    "mip_identifier": "512ef14957203c6323e79937f3935708",
    "organization_legal_name": "Grand Lodge of New York"
  },
  "member_profile": { /* See Common Data Formats: Member Profile */ }
}
```

**Request Payload Fields:**

- **shared_identifier**: The tracking ID from the original COGS request.
- **status**: "APPROVED" or "DECLINED".
- **good_standing**: Boolean indicating if the member is in good standing.
- **issued_at**: ISO 8601 timestamp when the certificate was issued.
- **valid_until**: ISO 8601 timestamp when the certificate expires.
- **issuing_organization**: The organization issuing the certificate.
  - **mip_identifier**: The issuing organization's MIP identifier.
  - **organization_legal_name**: Legal name of the issuing organization.
- **member_profile**: Comprehensive member information. See [Member Profile](#member-profile) in Common Data Formats.

#### Request Payload (Declined - Member Not in Good Standing):

```json
{
  "shared_identifier": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
  "status": "DECLINED",
  "good_standing": false,
  "reason": "Member is currently suspended for non-payment of dues.",
  "issuing_organization": {
    "mip_identifier": "512ef14957203c6323e79937f3935708",
    "organization_legal_name": "Grand Lodge of New York"
  }
}
```

- **reason**: Explanation for why the certificate was declined.

#### Response Payload:

```json
{
  "meta": {
    "succeeded": true
  },
  "data": {
    "acknowledged": true,
    "shared_identifier": "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
  }
}
```

- **meta.succeeded**: Boolean indicating the response was received successfully.
- **data.acknowledged**: Boolean confirming the COGS response was processed.
- **data.shared_identifier**: Echo of the request ID for correlation.

This end point is used by a node from which a COGS has been requested to respond to the requesting system with the COGS.

# Common Data Formats

All request and response payloads in MIP use JSON.

## Member Profile

The member profile provides comprehensive information about a member for use in responses such as the Certificate of Good Standing.

```json
{
  "member_number": "NY-123456",
  "prefix": "Mr",
  "first_name": "John",
  "middle_name": "William",
  "last_name": "Doe",
  "suffix": "Jr",
  "honorific": "RW",
  "rank": "PM",
  "birthdate": "1970-01-15",
  "years_in_good_standing": 25,
  "group_status": {
    "status": "Active",
    "is_active": true
  },
  "contact": {
    "email": "john.doe@example.com",
    "phone": "+1-555-123-4567",
    "cell": "+1-555-987-6543",
    "address": {
      "address1": "123 Main Street",
      "address2": "Apt 4B",
      "city": "Albany",
      "state": "NY",
      "postal_code": "12207",
      "country": "US"
    }
  },
  "affiliations": [
    {
      "local_name": "Masters Lodge No. 5",
      "local_number": "5",
      "local_location": "Albany, NY",
      "affiliation_type": "Full Member",
      "affiliation_status": "Active",
      "is_active": true,
      "level": "Primary",
      "date": "1999-03-15"
    }
  ],
  "life_cycle_events": [
    {
      "event_name": "Initiated",
      "date": "1999-01-10",
      "local_name": "Masters Lodge No. 5"
    },
    {
      "event_name": "Passed",
      "date": "1999-02-14",
      "local_name": "Masters Lodge No. 5"
    },
    {
      "event_name": "Raised",
      "date": "1999-03-15",
      "local_name": "Masters Lodge No. 5"
    }
  ]
}
```

**Member Profile Fields:**

- **member_number**: The member's identifier in the organization.
- **prefix**: Name prefix (Mr, Mrs, Dr, Rev, etc.).
- **first_name**, **middle_name**, **last_name**: Full legal name.
- **suffix**: Name suffix (Sr, Jr, III, etc.).
- **honorific**: Organizational honorific title (W, VW, RW, MW, etc.).
- **rank**: Past rank or position held (PM, PGM, PHP, PGHP, etc.).
- **birthdate**: Date of birth in ISO 8601 format (YYYY-MM-DD).
- **years_in_good_standing**: Number of years the member has been in good standing.
- **group_status**: Member's status at the jurisdiction/group level.
  - **status**: The status label as stored in the system.
  - **is_active**: Boolean indicating if this is an active membership status.
- **contact**: Contact information.
  - **email**: Primary email address.
  - **phone**: Primary phone number.
  - **cell**: Cell phone number.
  - **address**: Mailing address with standard fields.
- **affiliations**: Array of local group memberships (only includes locals that still exist, not merged/demised).
  - **local_name**: Name of the local lodge/chapter.
  - **local_number**: Lodge/chapter number.
  - **local_location**: City/location of the local.
  - **affiliation_type**: Member's type in this local (Full Member, Entered Apprentice, Fellowcraft, etc.).
  - **affiliation_status**: Status in this local (Active, NPD, Demitted, etc.).
  - **is_active**: Boolean indicating if this affiliation is active.
  - **level**: Affiliation level (Primary, Secondary, Dual).
  - **date**: Date of affiliation.
- **life_cycle_events**: Array of significant member events in chronological order.
  - **event_name**: Name of the event (Initiated, Passed, Raised, Affiliated, Demitted, etc.).
  - **date**: Date of the event in ISO 8601 format.
  - **local_name**: Lodge/chapter where the event occurred.

## Node Profile

The node profile provides information about a MIP organization node.

```json
{
  "mip_identifier": "512ef14957203c6323e79937f3935708",
  "mip_url": "https://mip.grandlodge-example.org/mip/node/512ef14957203c6323e79937f3935708",
  "organization_legal_name": "Grand Lodge of Example State",
  "contact_person": "John Smith",
  "contact_phone": "+1-555-123-4567",
  "organization_public_website": "https://grandlodge-example.org",
  "public_key": "-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqh...\n-----END PUBLIC KEY-----",
  "share_my_organization": true
}
```

**Node Profile Fields:**

- **mip_identifier**: The organization's 128-bit MIP identifier.
- **mip_url**: Full URL to the organization's MIP API endpoint.
- **organization_legal_name**: Official name of the organization.
- **contact_person**: Name of primary contact for MIP-related matters.
- **contact_phone**: Phone number for the contact person.
- **organization_public_website**: Public website URL of the organization.
- **public_key**: RSA public key in PEM format (included in connection requests and approvals).
- **share_my_organization**: Boolean indicating if this organization's info can be shared with other nodes.

## Endorsement

An Endorsement is a cryptographic vouching by one organization for another organization's identity. Endorsements form the basis of the web-of-trust model in MIP, allowing automatic approval of connection requests when sufficient trusted endorsements are present.

### Endorsement Document Format

The endorsement document is a canonical JSON object that is signed by the endorsing organization:

```json
{
  "type": "MIP_ENDORSEMENT_V1",
  "endorser_mip_identifier": "e82d40e9416304e8c72790b45b27a8e6",
  "endorsed_mip_identifier": "512ef14957203c6323e79937f3935708",
  "endorsed_public_key_fingerprint": "a1:b2:c3:d4:e5:f6:78:90:ab:cd:ef:12:34:56:78:90",
  "issued_at": "2026-02-04T12:00:00Z",
  "expires_at": "2027-02-04T12:00:00Z"
}
```

**Endorsement Document Fields:**

- **type**: Must be "MIP_ENDORSEMENT_V1" to identify the format version.
- **endorser_mip_identifier**: The MIP identifier of the organization creating the endorsement.
- **endorsed_mip_identifier**: The MIP identifier of the organization being endorsed.
- **endorsed_public_key_fingerprint**: MD5 fingerprint of the endorsed organization's public key. This binds the endorsement to a specific key, preventing key substitution attacks.
- **issued_at**: ISO 8601 timestamp when the endorsement was created.
- **expires_at**: ISO 8601 timestamp when the endorsement expires (typically 365 days from issuance).

### Full Endorsement Payload

When transmitting an endorsement (in connection requests or the /endorsements endpoint), the full payload includes:

```json
{
  "endorser_mip_identifier": "e82d40e9416304e8c72790b45b27a8e6",
  "endorsed_mip_identifier": "512ef14957203c6323e79937f3935708",
  "endorsed_public_key_fingerprint": "a1:b2:c3:d4:e5:f6:78:90:ab:cd:ef:12:34:56:78:90",
  "endorsement_document": "{\"type\":\"MIP_ENDORSEMENT_V1\",\"endorser_mip_identifier\":\"e82d40e9416304e8c72790b45b27a8e6\",\"endorsed_mip_identifier\":\"512ef14957203c6323e79937f3935708\",\"endorsed_public_key_fingerprint\":\"a1:b2:c3:d4:e5:f6:78:90:ab:cd:ef:12:34:56:78:90\",\"issued_at\":\"2026-02-04T12:00:00Z\",\"expires_at\":\"2027-02-04T12:00:00Z\"}",
  "endorsement_signature": "g2FAOk4wXU6+j85b+1kpz3kgRH+ZmFIk2YkNkCP5GP8l...",
  "issued_at": "2026-02-04T12:00:00Z",
  "expires_at": "2027-02-04T12:00:00Z"
}
```

**Full Payload Fields:**

- **endorsement_document**: The canonical JSON document (as a string) that was signed.
- **endorsement_signature**: Base64-encoded RSA signature of the endorsement_document using the endorser's private key.
- **issued_at**, **expires_at**: Duplicated from the document for convenience.

### Signature Generation

To create an endorsement signature:

```ruby
endorsement_document = {
  type: 'MIP_ENDORSEMENT_V1',
  endorser_mip_identifier: my_mip_identifier,
  endorsed_mip_identifier: their_mip_identifier,
  endorsed_public_key_fingerprint: their_public_key_fingerprint,
  issued_at: Time.current.iso8601,
  expires_at: 1.year.from_now.iso8601
}.to_json

signature = Base64.strict_encode64(
  private_key.sign(OpenSSL::Digest::SHA256.new, endorsement_document)
)
```

### Signature Verification

To verify an endorsement:

1. Parse the `endorsement_document` JSON string
2. Verify the `type` is "MIP_ENDORSEMENT_V1"
3. Verify the endorser is a trusted source (active connection or known shared node)
4. Retrieve the endorser's public key
5. Verify the signature: `public_key.verify(OpenSSL::Digest::SHA256.new, Base64.decode64(signature), endorsement_document)`
6. Verify `expires_at` is in the future
7. Verify `endorsed_public_key_fingerprint` matches the endorsed node's current public key

### Web-of-Trust Model

MIP uses a single-hop trust model:

- An organization only trusts endorsements from organizations it has **direct active connections** with
- There is no transitive trust (A trusts B, B trusts C does NOT mean A trusts C)
- Organizations can configure a trust threshold (default: 1 endorsement required)
- Endorsements expire (default: 365 days) and should be periodically renewed
- When a connection is revoked, endorsements from that connection should be invalidated

This model provides a balance between security and usability, allowing the network to grow efficiently while maintaining strong identity verification.
