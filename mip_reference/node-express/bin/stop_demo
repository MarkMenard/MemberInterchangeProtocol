#!/bin/bash

# MIP Reference Implementation - Demo Stop Script
# Stops all running MIP nodes

SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
ROOT_DIR="$(dirname "$SCRIPT_DIR")"

cd "$ROOT_DIR"

echo "Stopping MIP nodes..."

stopped=0

for i in 1 2 3; do
  pid_file="tmp/node${i}.pid"
  if [ -f "$pid_file" ]; then
    pid=$(cat "$pid_file")
    if kill -0 "$pid" 2>/dev/null; then
      echo "Stopping Node $i (PID $pid)..."
      kill "$pid" 2>/dev/null || true
      stopped=$((stopped + 1))
    else
      echo "Node $i not running (stale PID file)"
    fi
    rm -f "$pid_file"
  fi
done

if [ $stopped -eq 0 ]; then
  echo "No nodes were running."
else
  echo ""
  echo "Stopped $stopped node(s)."
fi

echo "Done."
